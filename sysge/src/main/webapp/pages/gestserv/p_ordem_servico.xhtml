<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</h:head>

<ui:composition template="/template/template.xhtml">
	<ui:define name="conteudo">
		<h:form id="formGeralServico">
			<p:panel header="Listagem de ordens de serviços">

				<h:panelGrid columns="6" id="panelPesquisa">
					<h:panelGrid columns="1">
						<p:outputLabel value="Nº OS" />
						<p:inputText id="txtServicoPesquisa" style="width: 90px;"
							value="#{ordemServicoController.ordemServico.id}" />
					</h:panelGrid>

					<h:panelGrid columns="1">
						<p:outputLabel value="Status" />
						<p:selectOneMenu
							value="#{ordemServicoController.ordemServico.statusOS}">
							<f:selectItems var="os"
								value="#{ordemServicoController.statusOs}"
								itemLabel="#{os.statusOS}" itemValue="#{os}" />
						</p:selectOneMenu>
					</h:panelGrid>

					<h:panelGrid columns="1">
						<p:outputLabel value="." style="color: white;" />
						<p:commandButton id="btnPesquisarOS" value="Pesquisar"
							icon="ui-icon-search" update=":msgGlobal formGeralServico"
							actionListener="#{ordemServicoController.pesquisarOS}" />
					</h:panelGrid>
					<p:focus context="panelPesquisa" />
					<p:blockUI block="tableServico" trigger="btnPesquisarOS">
					        Carregando! Aguarde...<br />
						<p:graphicImage library="img" name="loading.gif" />
					</p:blockUI>
				</h:panelGrid>

				<p:dataTable id="tableServico" var="s" paginator="true"
					paginatorPosition="bottom"
					emptyMessage="Nenhum registro encontrado!" rows="8"
					value="#{ordemServicoController.ordensServicos}"
					paginatorTemplate="{CurrentPageReport} {FirstPageLink} 
					{PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

					<p:column style="width:16px"
						rendered="#{ordemServicoController.ordemServico.statusOS != 'CANCELADO'}">
						<p:rowToggler />
					</p:column>

					<p:column headerText="Nº OS" width="40" style="text-align:center;">
						<p:outputLabel value="#{s.id}" />
					</p:column>

					<p:column
						headerText="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO' ? 'Data Saída' : 'Data Entrada'}"
						style="text-align:center;" width="100">
						<p:outputLabel
							value="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO' ? s.dataSaida : s.dataEntrada}">
							<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"
								timeZone="GMT-2" type="both" />
						</p:outputLabel>
					</p:column>

					<p:column headerText="Cliente">
						<p:outputLabel
							value="#{s.cliente.nomeFantasia}#{s.cliente.nomeDaPessoaFisica}" />
					</p:column>

					<p:column headerText="Total" style="text-align:center;" width="50">
						<p:outputLabel value="#{s.total}" style="color: blue;">
							<f:convertNumber pattern="###,###0.00" locale="pt_BR" />
						</p:outputLabel>
					</p:column>

					<p:column headerText="Status" style="text-align:center;"
						width="100">
						<p:outputLabel value="#{s.statusOS.statusOS}" />
					</p:column>

					<p:column width="40">
						<p:commandButton id="btnEditar" icon="ui-icon-pencil"
							actionListener="#{ordemServicoController.setarOrdemServico(s)}"
							update=":msgGlobal :formEditarOrdemServico">
						</p:commandButton>
						<p:tooltip value="Cliquei aqui para editar!" for="btnEditar"
							position="left" />
					</p:column>

					<f:facet name="footer">
						<p:commandButton value="Nova ordem de serviço"
							oncomplete="PF('dialogNovaOrdemDeServico').show();"
							icon="ui-icon-circle-plus"
							actionListener="#{ordemServicoController.novaOrdemServico}"
							update=":msgGlobal :formNovaOrdemServico" />
					</f:facet>

					<p:rowExpansion>
						<p:commandButton value="Imprimir nota de recebimento nº #{s.id}"
							icon="ui-icon-print" actionListener="#{ordemServicoController.gerarNotaRecebimento(s)}"/>
						<p:commandButton value="Imprimir ordem de serviço nº #{s.id}"
							icon="ui-icon-print" actionListener="#{ordemServicoController.gerarOrdemServico(s)}"/>
					</p:rowExpansion>

				</p:dataTable>
			</p:panel>

			<p:blockUI block="tableServico" trigger="tableServico">
			        Carregando! Aguarde...<br />
				<p:graphicImage library="img" name="loading.gif" />
			</p:blockUI>

		</h:form>

		<!-- Dialog nova ordem de Serviço -->
		<p:dialog widgetVar="dialogNovaOrdemDeServico"
			header="Nova Ordem de Serviço" modal="true" appendTo="@(body)"
			resizable="false" position="top" width="938" closable="false">
			<h:form id="formNovaOrdemServico">
				<p:tabView id="tabViewNovaOS"
					activeIndex="#{ordemServicoController.currentTab}">
					<p:tab title="Dados Básicos">

						<h:panelGrid columns="8">
							<h:panelGrid columns="1">
								<p:outputLabel value="Data Entrada" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.dataEntrada}"
									readonly="true" style="width: 200px;">
									<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"
										timeZone="GMT-2" type="both" />
								</p:inputText>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Hora Entrada" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.horaEntrada}"
									readonly="true" style="width: 205px;">
									<f:convertDateTime pattern="HH:mm" locale="pt_BR"
										timeZone="GMT-2" type="both" />
								</p:inputText>
							</h:panelGrid>
						</h:panelGrid>

						<h:panelGrid columns="5">
							<h:panelGrid columns="1">
								<p:outputLabel value="Status" />
								<p:selectOneMenu
									value="#{ordemServicoController.ordemServico.statusOS}">
									<f:selectItems var="os"
										value="#{ordemServicoController.statusOs}"
										itemLabel="#{os.statusOS}" itemValue="#{os}" />
								</p:selectOneMenu>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Cliente" />
								<p:inputText id="txtCliente"
									value="#{ordemServicoController.ordemServico.cliente.nomeTemporario}"
									style="width: 350px;" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="." style="color: white;" />
								<p:commandButton id="btnProcurarClienteDialog"
									icon="ui-icon-search"
									actionListener="#{ordemServicoController.obterPageCliente}">
									<p:ajax event="dialogReturn"
										listener="#{ordemServicoController.clienteSelecionado}"
										process="@this" update="txtCliente" />
								</p:commandButton>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Técnico / Responsável" />
								<p:selectOneMenu style="width: 255px;"
									value="#{ordemServicoController.ordemServico.funcionario}"
									converter="omnifaces.SelectItemsConverter" filter="true"
									filterMatchMode="startsWith">
									<f:selectItems var="fun"
										value="#{ordemServicoController.funcionarios}"
										itemLabel="#{fun.nome}" itemValue="#{fun}" />
								</p:selectOneMenu>
							</h:panelGrid>

							<p:blockUI block="formNovaOrdemServico"
								trigger="btnProcurarClienteDialog">
								        Carregando! Aguarde...<br />
								<p:graphicImage library="img" name="loading.gif" />
							</p:blockUI>

						</h:panelGrid>


						<h:panelGrid columns="4">
							<h:panelGrid columns="1">
								<p:outputLabel value="Marca" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.marca}"
									style="width: 230px;" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Nº de Série" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.numeroSerie}" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Modelo" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.modelo}"
									style="width: 250px;" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Nº Patrimônio" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.numeroPatrimonio}" />
							</h:panelGrid>
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="Acessórios" />
							<p:inputText style="width: 855px;"
								value="#{ordemServicoController.ordemServico.acessorios}" />
						</h:panelGrid>

						<!-- <h:panelGrid columns="1">
							<p:outputLabel value="Descrição Produto / Serviço" />
							<p:inputTextarea style="width: 725px;" />
						</h:panelGrid> -->

						<h:panelGrid columns="1">
							<p:outputLabel value="Defeito" />
							<p:inputTextarea style="width: 855px;"
								value="#{ordemServicoController.ordemServico.defeito}" />
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="Laudo Técnico" />
							<p:inputTextarea style="width: 855px; color: blue"
								value="#{ordemServicoController.ordemServico.laudoTecnico}" />
						</h:panelGrid>
					</p:tab>

					<!-- <p:tab title="Serviços">
					
						<h:panelGrid columns="5">
							<p:commandButton id="btnProcurarServicoDialog"
								icon="ui-icon-search"
								actionListener="#{ordemServicoController.obterPageServico}"
								value="Procurar">
								<p:ajax event="dialogReturn"
									listener="#{ordemServicoController.servicoSelecionado}"
									process="@this" update=":msgGlobal tableServico :formNovaOrdemServico:tabViewNovaOS" />
							</p:commandButton>

							<p:blockUI block="formNovaOrdemServico"
								trigger="btnProcurarServicoDialog">
								        Carregando! Aguarde...<br />
								<p:graphicImage library="img" name="loading.gif" />
							</p:blockUI>

						</h:panelGrid>

						<p:dataTable emptyMessage="Nenhum serviço encontrado!"
							id="tableServico" var="s"
							value="#{ordemServicoController.listaServicos}" paginator="true"
							paginatorPosition="bottom" rows="7">
							
							<p:column headerText="ID" width="35" style="text-align:center;">
								<h:outputLabel value="#{s.servico.id}" />
							</p:column>
							<p:column headerText="Nome">
								<h:outputLabel value="#{s.servico.nome}" />
							</p:column>
							<p:column headerText="Quantidade">
								<p:spinner min="1" value="#{s.quantidade}" style="width: 200px;">
									<p:ajax
										listener="#{ordemServicoController.calcularValorServico(s)}"
										update="tableServico" />
								</p:spinner>
							</p:column>
							<p:column headerText="Valor" width="120" style="text-align:center;">
								<h:outputLabel value="#{s.servico.valor}" style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							<p:column headerText="Subtotal" width="120" style="text-align:center;">
								<h:outputLabel id="txtTotalServico" value="#{s.subTotal}" style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							<p:column width="30">
								<p:commandButton icon="ui-icon-close" />
							</p:column>
							
							<p:columnGroup type="footer">
								<p:row>
									<p:column colspan="4" style="text-align:right" footerText="Total:" />
									<p:column footerText="R$: #{ordemServicoController.ordemServico.totalServico}" style="text-align:left" />
								</p:row>
							</p:columnGroup>
							
						</p:dataTable>
					</p:tab> -->

					<!-- <p:tab title="Produto">
						<h:panelGrid columns="5">
							<p:commandButton id="btnProcurarProdutoDialog"
								icon="ui-icon-search"
								actionListener="#{ordemServicoController.obterPageProduto}"
								value="Procurar">
								<p:ajax event="dialogReturn"
									listener="#{ordemServicoController.produtoSelecionado}"
									process="@this" update=":msgGlobal tableProduto :formNovaOrdemServico:tabViewNovaOS" />
							</p:commandButton>

							<p:blockUI block="formNovaOrdemServico"
								trigger="btnProcurarProdutoDialog">
								        Carregando! Aguarde...<br />
								<p:graphicImage library="img" name="loading.gif" />
							</p:blockUI>

						</h:panelGrid>
						<p:dataTable emptyMessage="Nenhum produto encontrado!" id="tableProduto" 
							var="p"	value="#{ordemServicoController.listaProdutos}" paginator="true"
							paginatorPosition="bottom" rows="7">
							
							<p:column headerText="ID" width="35" style="text-align:center;">
								<h:outputLabel value="#{p.produto.id}" />
							</p:column>
							<p:column headerText="Descrição">
								<h:outputLabel value="#{p.produto.descricaoProduto}" />
							</p:column>
							<p:column headerText="Quantidade">
								<p:spinner min="1" value="#{p.quantidade}" style="width: 200px;">
									<p:ajax
										listener="#{ordemServicoController.calcularValorProduto(p)}"
										update="tableProduto" />
								</p:spinner>
							</p:column>
							<p:column headerText="Valor" width="120" style="text-align:center;">
								<h:outputLabel value="#{p.produto.valorVenda}" style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							<p:column headerText="Subtotal" width="120" style="text-align:center;">
								<h:outputLabel id="txtTotalServico" value="#{p.subTotal}" style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							<p:column width="30">
								<p:commandButton icon="ui-icon-close" />
							</p:column>
							
							<p:columnGroup type="footer">
								<p:row>
									<p:column colspan="4" style="text-align:right" footerText="Total:" />
									<p:column footerText="R$: #{ordemServicoController.ordemServico.totalProduto}" style="text-align:left" />
								</p:row>
							</p:columnGroup>
						</p:dataTable>
					</p:tab> -->

					<p:tab title="Informações complementares">

						<h:panelGrid columns="1">
							<p:outputLabel value="Observações" />
							<p:inputTextarea style="width: 855px;"
								value="#{ordemServicoController.ordemServico.observacoes}" />
						</h:panelGrid>

						<h:panelGrid columns="1"
							rendered="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}">
							<p:outputLabel value="Motivo do cancelamento" />
							<p:inputTextarea style="width: 855px;"
								value="#{ordemServicoController.ordemServico.motivoCancelamento}" />
						</h:panelGrid>

					</p:tab>

				</p:tabView>

				<br></br>

				<p:fieldset>
					<h:panelGrid columns="3">
						<p:commandButton value="Salvar" icon="ui-icon-circle-check"
							actionListener="#{ordemServicoController.salvar}"
							update=":msgGlobal :formGeralServico:tableServico" />

						<p:commandButton value="Cancelar" icon="ui-icon-closethick"
							oncomplete="PF('dialogNovaOrdemDeServico').hide();" />
					</h:panelGrid>
				</p:fieldset>
			</h:form>
		</p:dialog>

		<!-- Dialog editar ordem de Serviço -->
		<p:dialog widgetVar="dialogEditarOrdemDeServico"
			header="Editar Ordem de Serviço" modal="true" appendTo="@(body)"
			resizable="false" position="top" width="938" closable="false">
			<h:form id="formEditarOrdemServico">

				<p:tabView id="tabViewEditarOS"
					activeIndex="#{ordemServicoController.currentTab}">
					<p:tab title="Dados Básicos">

						<h:panelGrid columns="2">
							<p:outputLabel styleClass="texto_negrito" value="Nº OS: " />
							<p:outputLabel styleClass="texto_negrito" style="color: blue;"
								value="#{ordemServicoController.ordemServico.id}" />
						</h:panelGrid>

						<h:panelGrid columns="8">
							<h:panelGrid columns="1">
								<p:outputLabel value="Data Entrada" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.dataEntrada}"
									readonly="true" style="width: 200px;">
									<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"
										timeZone="GMT-2" type="both" />
								</p:inputText>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Hora Entrada" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.horaEntrada}"
									readonly="true" style="width: 205px;">
									<f:convertDateTime pattern="HH:mm" locale="pt_BR"
										timeZone="GMT-3" type="both" />
								</p:inputText>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Data Saída" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.dataSaida}"
									readonly="true" style="width: 200px;">
									<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"
										timeZone="GMT-2" type="both" />
								</p:inputText>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Hora Saída" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.horaSaida}"
									style="width: 210px;" readonly="true">
									<f:convertDateTime pattern="HH:mm" locale="pt_BR"
										timeZone="GMT-3" type="both" />
								</p:inputText>
							</h:panelGrid>
						</h:panelGrid>

						<h:panelGrid columns="5">
							<h:panelGrid columns="1">
								<p:outputLabel value="Status" />
								<p:selectOneMenu
									value="#{ordemServicoController.ordemServico.statusOS}">
									<f:selectItems var="os"
										value="#{ordemServicoController.statusOs}"
										itemLabel="#{os.statusOS}" itemValue="#{os}" />
								</p:selectOneMenu>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Cliente" />
								<p:inputText id="txtCliente"
									value="#{ordemServicoController.ordemServico.cliente.nomeTemporario}"
									style="width: 350px;" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="." style="color: white;" />
								<p:commandButton id="btnProcurarClienteDialog"
									icon="ui-icon-search"
									actionListener="#{ordemServicoController.obterPageCliente}"
									disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}">
									<p:ajax event="dialogReturn"
										listener="#{ordemServicoController.clienteSelecionado}"
										process="@this" update="txtCliente" />
								</p:commandButton>
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Técnico / Responsável" />
								<p:selectOneMenu style="width: 255px;"
									value="#{ordemServicoController.ordemServico.funcionario}"
									converter="omnifaces.SelectItemsConverter" filter="true"
									filterMatchMode="startsWith">
									<f:selectItems var="fun"
										value="#{ordemServicoController.funcionarios}"
										itemLabel="#{fun.nome}" itemValue="#{fun}" />
								</p:selectOneMenu>
							</h:panelGrid>

							<p:blockUI block="formEditarOrdemServico"
								trigger="btnProcurarClienteDialog">
								        Carregando! Aguarde...<br />
								<p:graphicImage library="img" name="loading.gif" />
							</p:blockUI>

						</h:panelGrid>


						<h:panelGrid columns="4">
							<h:panelGrid columns="1">
								<p:outputLabel value="Marca" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.marca}"
									style="width: 230px;" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Nº de Série" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.numeroSerie}" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Modelo" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.modelo}"
									style="width: 250px;" />
							</h:panelGrid>
							<h:panelGrid columns="1">
								<p:outputLabel value="Nº Patrimônio" />
								<p:inputText
									value="#{ordemServicoController.ordemServico.numeroPatrimonio}" />
							</h:panelGrid>
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="Acessórios" />
							<p:inputText style="width: 855px;"
								value="#{ordemServicoController.ordemServico.acessorios}" />
						</h:panelGrid>

						<!-- <h:panelGrid columns="1">
							<p:outputLabel value="Descrição Produto / Serviço" />
							<p:inputTextarea style="width: 725px;" />
						</h:panelGrid> -->

						<h:panelGrid columns="1">
							<p:outputLabel value="Defeito" />
							<p:inputTextarea style="width: 855px;"
								value="#{ordemServicoController.ordemServico.defeito}" />
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="Laudo Técnico" />
							<p:inputTextarea style="width: 855px; color: blue"
								value="#{ordemServicoController.ordemServico.laudoTecnico}" />
						</h:panelGrid>
					</p:tab>

					<p:tab title="Serviços">

						<h:panelGrid columns="5">
							<p:commandButton id="btnProcurarServicoDialog"
								icon="ui-icon-search"
								actionListener="#{ordemServicoController.obterPageServico}"
								disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}"
								value="Procurar">
								<p:ajax event="dialogReturn"
									listener="#{ordemServicoController.servicoSelecionado}"
									process="@this"
									update=":msgGlobal tableServico :formEditarOrdemServico:tabViewEditarOS" />
							</p:commandButton>

							<p:blockUI block="formEditarOrdemServico"
								trigger="btnProcurarServicoDialog">
								        Carregando! Aguarde...<br />
								<p:graphicImage library="img" name="loading.gif" />
							</p:blockUI>

						</h:panelGrid>

						<p:dataTable emptyMessage="Nenhum serviço encontrado!"
							id="tableServico" var="s"
							value="#{ordemServicoController.listaServicos}" paginator="true"
							paginatorPosition="bottom" rows="7">

							<p:column headerText="Nome">
								<h:outputLabel value="#{s.servico.nome}" />
							</p:column>
							<!-- <p:column headerText="Quantidade">
								<p:spinner min="1" value="#{s.quantidade}" style="width: 200px;">
									<p:ajax
										listener="#{ordemServicoController.calcularValorServico(s)}"
										update="tableServico :formEditarOrdemServico:tabViewEditarOS:panel_2_pagamento" />
								</p:spinner>
							</p:column> -->
							<!-- <p:column headerText="Valor" width="120">
								<h:outputLabel value="#{s.servico.valor}" style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column> -->
							<p:column headerText="Valor" width="120">
								<h:outputLabel id="txtTotalServico" value="#{s.subTotal}"
									style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							<p:column width="30">
								<p:commandButton icon="ui-icon-close"
									disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}"
									actionListener="#{ordemServicoController.removerServico(s)}"
									update="tableServico :formEditarOrdemServico:tabViewEditarOS:panel_2_pagamento">

									<p:confirm header="Confirmação"
										message="Deseja realmente excluir esse serviço? '#{s.servico.nome}'"
										icon="ui-icon-alert" />

								</p:commandButton>

								<p:confirmDialog global="true" showEffect="fade"
									hideEffect="fade">
									<p:commandButton value="Sim" styleClass="ui-confirmdialog-yes"
										icon="ui-icon-check" />
									<p:commandButton value="Não" styleClass="ui-confirmdialog-no"
										icon="ui-icon-close" />
								</p:confirmDialog>

							</p:column>

							<p:columnGroup type="footer">
								<p:row>
									<p:column colspan="1" style="text-align:right"
										footerText="Total:" />
									<p:column
										footerText="R$: #{ordemServicoController.ordemServico.totalServico}"
										style="text-align:left" />
								</p:row>
							</p:columnGroup>

						</p:dataTable>
					</p:tab>

					<p:tab title="Produto">
					
						<h:panelGrid columns="5">
							<p:commandButton id="btnProcurarProdutoDialog"
								icon="ui-icon-search"
								actionListener="#{ordemServicoController.obterPageProduto}"
								value="Procurar"
								disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}">
								<p:ajax event="dialogReturn"
									listener="#{ordemServicoController.produtoSelecionado}"
									process="@this"
									update=":msgGlobal tableProduto :formEditarOrdemServico:tabViewEditarOS" />
							</p:commandButton>

							<p:blockUI block="formEditarOrdemServico"
								trigger="btnProcurarProdutoDialog">
								        Carregando! Aguarde...<br />
								<p:graphicImage library="img" name="loading.gif" />
							</p:blockUI>

						</h:panelGrid>

						<p:dataTable emptyMessage="Nenhum produto encontrado!"
							id="tableProduto" var="p"
							value="#{ordemServicoController.listaProdutos}" paginator="true"
							paginatorPosition="bottom" rows="7"
							disabledSelection="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}">

							<p:column headerText="Descrição">
								<h:outputLabel value="#{p.produto.descricaoProduto}" />
							</p:column>
							<p:column headerText="Qtde" style="text-align:center;" width="30">
								<p:outputLabel value="#{p.quantidade}" />
							</p:column>
							
							<p:column headerText="Valor" width="120"
								style="text-align:center;">
								<h:outputLabel value="#{p.produto.valorVenda}"
									style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							
							<p:column headerText="Subtotal" width="120"
								style="text-align:center;">
								<h:outputLabel id="txtTotalServico" value="#{p.subTotal}"
									style="color: blue;">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>

							<p:column width="30">
								<p:commandButton icon="ui-icon-plusthick"
									oncomplete="PF('dialog_quantidade_estoque_produto').show();" 
									update=":form_qtde_produto" id="btnQtdeProduto"
									actionListener="#{ordemServicoController.setarProduto(p)}"
									disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}"/>
								<p:tooltip value="Cliquei aqui adicionar a quantidade!" for="btnQtdeProduto"
										   position="left" />	
							</p:column>

							<p:column width="30">
								<p:commandButton id="btnExcluirProduto" icon="ui-icon-close"
									disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}"
									actionListener="#{ordemServicoController.removerProduto(p)}"
									update="tableProduto :formEditarOrdemServico:tabViewEditarOS:panel_2_pagamento">

									<p:confirm header="Confirmação"
										message="Deseja realmente excluir esse produto '#{p.produto.descricaoProduto}'"
										icon="ui-icon-alert" />

								</p:commandButton>

								<p:confirmDialog global="true" showEffect="fade"
									hideEffect="fade">
									<p:commandButton value="Sim" styleClass="ui-confirmdialog-yes"
										icon="ui-icon-check" />
									<p:commandButton value="Não" styleClass="ui-confirmdialog-no"
										icon="ui-icon-close" />
								</p:confirmDialog>
								
								<p:tooltip value="Cliquei aqui excluir!" for="btnExcluirProduto"
										   position="left" />
										   
							</p:column>

							<p:columnGroup type="footer">
								<p:row>
									<p:column colspan="3" style="text-align:right"
										footerText="Total:" />
									<p:column
										footerText="R$: #{ordemServicoController.ordemServico.totalProduto}"
										style="text-align:left" />
								</p:row>
							</p:columnGroup>
						</p:dataTable>

					</p:tab>

					<p:tab title="Pagamento" id="pagamento">

						<p:fieldset>
							<h:panelGrid columns="4" id="panel_2_pagamento">
								<h:panelGrid columns="1">
									<p:outputLabel value="Tipo de desconto" />
									<p:selectOneMenu id="som_tipo_desconto"
										value="#{ordemServicoController.ordemServico.tipoDesconto}">
										<f:selectItem itemLabel="Selecione o tipo de Desconto" />
										<f:selectItems var="td"
											value="#{ordemServicoController.tiposDesconto}"
											itemLabel="#{td.tipoDesconto}" itemValue="#{td}" />
										<p:ajax event="change" update="panel_2_pagamento"
											process="som_tipo_desconto" />
									</p:selectOneMenu>
								</h:panelGrid>

								<h:panelGrid columns="1"
									rendered="#{ordemServicoController.ordemServico.tipoDesconto == 'DESCONTO_REAIS'}">
									<p:outputLabel value="Desconto R$" />
									<p:spinner stepFactor="0.1" min="0" prefix="R$: "
										max="#{ordemServicoController.ordemServico.total}"
										value="#{ordemServicoController.ordemServico.descontoReais}">
										<p:ajax
											listener="#{ordemServicoController.calcularDescontoReais}"
											process="@this" update="txtValorTotalPagamento" />
									</p:spinner>
								</h:panelGrid>

								<h:panelGrid columns="1"
									rendered="#{ordemServicoController.ordemServico.tipoDesconto == 'DESCONTO_PORCENTAGEM'}">
									<p:outputLabel value="Desconto %" />
									<p:spinner min="0" prefix="% " max="100"
										value="#{ordemServicoController.ordemServico.descontoPorcento}">
										<p:ajax
											listener="#{ordemServicoController.calcularDescontoPorcentagem}"
											process="@this" update="txtValorTotalPagamento" />
									</p:spinner>
								</h:panelGrid>

								<h:panelGrid columns="1">
									<p:outputLabel value="Total" />
									<p:inputNumber symbol="R$ " decimalSeparator=","
										thousandSeparator="."
										value="#{ordemServicoController.ordemServico.total}"
										id="txtValorTotalPagamento" readonly="true" />
								</h:panelGrid>

							</h:panelGrid>
						</p:fieldset>

						<br></br>

						<h:panelGrid columns="4" id="panel_1_pagamento">
							<h:panelGrid columns="1">
								<p:outputLabel value="Forma de pagamento" />
								<p:selectOneMenu
									value="#{ordemServicoController.ordemServico.formaPagamento}">
									<f:selectItems var="fp"
										value="#{ordemServicoController.formaPagamento}"
										itemLabel="#{fp.formaPagamento}" itemValue="#{fp}" />
								</p:selectOneMenu>
							</h:panelGrid>

							<h:panelGrid columns="1">
								<p:outputLabel value="Condição de pagamento" />
								<p:selectOneMenu converter="omnifaces.SelectItemsConverter"
									value="#{ordemServicoController.ordemServico.condicaoPagamento}"
									filter="true" filterMatchMode="startsWith">
									<f:selectItems var="c"
										value="#{ordemServicoController.condicoesPagamento}"
										itemLabel="#{c.descricao}" itemValue="#{c}" />
								</p:selectOneMenu>
							</h:panelGrid>

							<h:panelGrid columns="1">
								<p:outputLabel value="." style="color: white;" />
								<p:commandButton value="Gerar parcelas" icon="ui-icon-tag"
									actionListener="#{ordemServicoController.gerarParcelas}"
									update=":msgGlobal tableParcelas"
									disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}"/>
							</h:panelGrid>

						</h:panelGrid>

						<p:dataTable var="p" emptyMessage="Nenhum registro encontrado!"
							paginator="true" paginatorPosition="bottom"
							value="#{ordemServicoController.parcelas}" rows="4"
							id="tableParcelas">

							<p:column headerText="Nº" width="20" style="text-align:center;">
								<h:outputLabel value="#{p.numero}º" />
							</p:column>
							<p:column headerText="Parcela" style="text-align:center;"
								width="100">
								<h:outputLabel value="#{p.valorParcela}">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							<p:column headerText="Desconto" style="text-align:center;"
								width="200">
								<p:spinner min="0" max="#{p.valorParcela}"
									value="#{p.valorDesconto}" prefix="R$: ">
									<p:ajax
										listener="#{ordemServicoController.calcularDescontoParcela(p)}"
										process="@this" update="txtValorCobradoParcela" />
								</p:spinner>
							</p:column>
							<p:column headerText="Valor cobrado" style="text-align:center;"
								width="100">
								<h:outputLabel id="txtValorCobradoParcela"
									value="#{p.valorCobrado}">
									<f:convertNumber pattern="###,###.00" locale="pt_BR" />
								</h:outputLabel>
							</p:column>
							<p:column headerText="Vencimento" style="text-align:center;">
								<h:outputLabel value="#{p.dataVencimento}">
									<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"
										timeZone="GMT-2" type="both" />
								</h:outputLabel>
							</p:column>
							<p:column style="text-align:center;">
								<p:commandButton id="btn_pago" icon="ui-icon-check"
									disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO' || p.statusFinanceiro == 'PAGO'}" 
									actionListener="#{ordemServicoController.setarConfirmacaoPagamento(p)}"
									update=":msgGlobal :form_confirm_pagamento"
									rendered="#{p.statusFinanceiro != null}"/>
									
								<p:commandButton id="btn_boleto" icon="ui-icon-bookmark"
									disabled="true"/>
									
								<p:commandButton id="btn_comprovante" icon="ui-icon-print"
									disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}" ajax="false"
									actionListener="#{ordemServicoController.gerarComprovantePagamento(p)}">
								</p:commandButton>	

								<p:tooltip for="btn_pago" position="left" value="Pago ?" />
								<p:tooltip for="btn_boleto" position="left" value="Gerar boleto" />
								<p:tooltip for="btn_comprovante" position="left"
									value="Gerar recibo de pagamento" />
							</p:column>
						</p:dataTable>

					</p:tab>

					<p:tab title="Informações complementares">

						<h:panelGrid columns="1">
							<p:outputLabel value="Observações" />
							<p:inputTextarea style="width: 855px;"
								value="#{ordemServicoController.ordemServico.observacoes}" />
						</h:panelGrid>

						<h:panelGrid columns="1"
							rendered="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}">
							<p:outputLabel value="Motivo do cancelamento" />
							<p:inputTextarea style="width: 855px;"
								value="#{ordemServicoController.ordemServico.motivoCancelamento}" />
						</h:panelGrid>

					</p:tab>

				</p:tabView>

				<br></br>

				<p:fieldset>
					<h:panelGrid columns="5">
						<p:commandButton value="Salvar" icon="ui-icon-circle-check"
							actionListener="#{ordemServicoController.salvar}"
							update=":msgGlobal :formGeralServico:tableServico :motivo_cancelamento"
							disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}" />

						<p:commandButton value="Cancelar" icon="ui-icon-closethick"
							actionListener="#{ordemServicoController.fecharDialogs}"
							update=":msgGlobal :formGeralServico:tableServico" />

						<p:commandButton value="Enviar por E-mail"
							icon="ui-icon-mail-closed"
							oncomplete="PF('dialog_envio_email').show();"
							disabled="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}" />

						<p:outputLabel value=" OBS:" styleClass="texto_negrito"
							rendered="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}" />

						<p:outputLabel value=" Ordem de serviço apenas para visualização!"
							rendered="#{ordemServicoController.ordemServico.statusOS == 'CANCELADO'}" />

					</h:panelGrid>
				</p:fieldset>
			</h:form>
		</p:dialog>
		
		<p:dialog header="Adicione a quantidade!" closable="false"
			draggable="false" resizable="false" maximizable="false"
			widgetVar="dialog_quantidade_estoque_produto" modal="true"
			appendTo="@(body)">

			<h:form id="form_qtde_produto">
				
				<h:panelGrid columns="2">
					<h:panelGrid columns="1">
						<p:outputLabel value="Produto"/>
						<p:inputText value="#{ordemServicoController.produtoOrdemServico.produto.descricaoProduto}" style="width: 300px;"/>
					</h:panelGrid>
				</h:panelGrid>	
			
				<h:panelGrid columns="2">
					<h:panelGrid columns="1">
						<p:outputLabel value="Quantidade"/>
						<p:spinner min="0" value="#{ordemServicoController.quantidadeAdicionada}" style="width: 200px;"/>
					</h:panelGrid>
				</h:panelGrid>
				
				<h:panelGrid columns="2">
					<h:panelGrid columns="2">
						<p:commandButton value="Salvar" icon="ui-icon-check" actionListener="#{ordemServicoController.calcularValorProduto}"
										 update=":msgGlobal :formEditarOrdemServico:tabViewEditarOS:tableProduto :formEditarOrdemServico:tabViewEditarOS:panel_2_pagamento"/>	
						<p:commandButton value="Cancelar" icon="ui-icon-closethick" oncomplete="PF('dialog_quantidade_estoque_produto').hide();" update=":msgGlobal :formEditarOrdemServico:tabViewEditarOS:tableProduto :formEditarOrdemServico:tabViewEditarOS:panel_2_pagamento"/>	
					</h:panelGrid>
				</h:panelGrid>	
			</h:form>

		</p:dialog>

		<p:dialog header="Motivo do Cancelamento" closable="false"
			draggable="false" resizable="false" maximizable="false"
			widgetVar="dialog_motivo_cancelamento" modal="true"
			appendTo="@(body)">
			<h:form id="motivo_cancelamento">

				<h:panelGrid columns="1">
					<h:outputLabel
						value="Deseja realmente cancelar essa ordem de serviço?"
						styleClass="texto_negrito" />
					<h:outputLabel
						value="Uma vez cancelada, não poderá ser reaberta! A mesma ficará disponível apenas para visualização!"
						styleClass="texto_negrito" />
				</h:panelGrid>

				<h:panelGrid columns="1">
					<p:outputLabel value="Motivo do cancelamento" />
					<p:inputTextarea style="width: 855px;"
						value="#{ordemServicoController.ordemServico.motivoCancelamento}" />
				</h:panelGrid>
				<h:panelGrid columns="2">
					<p:commandButton value="Salvar"
						actionListener="#{ordemServicoController.salvarMotivoCancelamento}"
						update=":msgGlobal" 
						icon="ui-icon-check"/>
					<p:commandButton value="Cancelar"
						oncomplete="PF('dialog_motivo_cancelamento').hide();"
						update=":formGeralServico"
						actionListener="#{ordemServicoController.fecharDialogMotivoCancelamento}" 
						icon="ui-icon-closethick"/>
				</h:panelGrid>
			</h:form>
		</p:dialog>

		<p:dialog header="Escolha uma das opções abaixo" closable="true"
			draggable="false" resizable="false" maximizable="false"
			widgetVar="dialog_opcoes" modal="true" appendTo="@(body)">
			<h:form>
				<p:fieldset>
					<p:commandButton value="Imprimir nota de recebimento"
						icon="ui-icon-print" />
					<p:commandButton value="Imprimir ordem de serviço"
						icon="ui-icon-print" />
					<!-- <p:commandButton value="Enviar por email"
						icon="ui-icon-mail-closed"
						oncomplete="PF('dialog_envio_email').show();" /> -->
					<p:commandButton value="Cancelar" oncomplete="PF('dialog_opcoes').hide();" icon="ui-icon-closethick"/>	
				</p:fieldset>
			</h:form>
		</p:dialog>

		<p:dialog header="Envio de email" closable="true" draggable="true"
			resizable="false" maximizable="false" widgetVar="dialog_envio_email"
			modal="true" appendTo="@(body)" position="top">
			<h:form>
				<p:fieldset>

					<p:panelGrid columns="1">
						<h:panelGrid columns="1">
							<p:outputLabel value="Nome destinatário" />
							<p:inputText style="width: 400px;" />
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="E-mail destinatário" />
							<p:inputText style="width: 400px;" />
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="De" />
							<p:inputText style="width: 400px;" />
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="Assunto" />
							<p:inputText style="width: 400px;" />
						</h:panelGrid>

						<h:panelGrid columns="1">
							<p:outputLabel value="Mensagem" />
							<p:editor id="editor" widgetVar="editorWidget" width="400" />
						</h:panelGrid>

						<h:panelGrid columns="2">
							<p:commandButton value="Enviar" icon="ui-icon-extlink" />
							<p:commandButton value="Cancelar" icon="ui-icon-close"
								oncomplete="PF('dialog_envio_email').hide();" />
						</h:panelGrid>
					</p:panelGrid>


				</p:fieldset>
			</h:form>
		</p:dialog>
		
		<p:dialog header="Confirmação" closable="true" draggable="true"
			resizable="false" maximizable="false" widgetVar="dialog_confirmacao_valor_parcelas"
			modal="true" appendTo="@(body)" position="top">
			
			<h:form>
				<h:panelGrid columns="1">
					<p:outputLabel value="O valor total da O.S está diferente da soma dos valores das parcelas, "/>
					<p:outputLabel value="deseja continuar e salvar a ordem de serviço?"/>
				</h:panelGrid>
				
				<h:panelGrid columns="2">
					<p:commandButton value="Salvar" actionListener="#{ordemServicoController.confirmarSalvamentoOS}" icon="ui-icon-disk"/>	
					<p:commandButton value="Cancelar" oncomplete="PF('dialog_confirmacao_valor_parcelas').hide();" icon="ui-icon-closethick"/>	
				</h:panelGrid>
			</h:form>
		
		</p:dialog>
		
		<p:dialog header="Confirmação de pagamento" closable="true" draggable="true"
			resizable="false" maximizable="false" widgetVar="dialog_confirmar_pagamento"
			modal="true" appendTo="@(body)" position="top">
			
			<h:form id="form_confirm_pagamento">
				<p:panelGrid columns="2">
					<p:outputLabel value="Parcela"/>
					<p:outputLabel value="#{ordemServicoController.parcela.numero} de #{ordemServicoController.parcela.quantidadeParcelas}"/>
					
					<p:outputLabel value="Vencimento"/>
					<p:outputLabel value="#{ordemServicoController.parcela.dataVencimento}">
						<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR"
								timeZone="GMT-2" type="both" />
					</p:outputLabel>
					
					<p:outputLabel value="Data pagamento"/>
					<p:calendar showOn="button" value="#{ordemServicoController.parcela.dataPagamento}" pattern="dd/MM/yyyy" mask="true"/>
				</p:panelGrid>
				
				<p:separator/>
				
				<p:panelGrid columns="2">
					<p:commandButton value="Confirmar pagamento" icon="ui-icon-check" 
									 actionListener="#{ordemServicoController.confirmarPagamentoParcela}"
									 update=":msgGlobal :formEditarOrdemServico:tabViewEditarOS:tableParcelas"/>
					<p:commandButton value="Cancelar" icon="ui-icon-closethick" oncomplete="PF('dialog_confirmar_pagamento').hide();"/>
				</p:panelGrid>
			</h:form>
			
		</p:dialog>	
		
	</ui:define>
</ui:composition>

</html>